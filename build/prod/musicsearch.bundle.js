"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var o=0,t=Array(e.length);o<e.length;o++)t[o]=e[o];return t}return Array.from(e)}function _toConsumableArray(e){if(Array.isArray(e)){for(var o=0,t=Array(e.length);o<e.length;o++)t[o]=e[o];return t}return Array.from(e)}angular.module("albums",["modalHelper"]).controller("albumsCtrl",["$scope","modalHelper",function(e,o){e.model=[],e.showLoader=!0;var t="openAlbumsModal";o.on("reset",function(r){t===r&&(e.model=o.getModel())}),o.on("showLoader",function(o){t===o&&(e.showLoader=!0)}),o.on("hideLoader",function(o){t===o&&(e.showLoader=!1)}),o.on("clearModel",function(o){t===o&&(e.model=[])}),e.getPic=o.getPic,e.close=function(){o.publish("close",[e.model.modalId])}}]),angular.module("artist",["modalHelper","ngAudio"]).controller("artistCtrl",["$scope","modalHelper","ngAudio","$interval",function(e,o,t,r){e.model=[],e.showLoader=!0;var a={},n="openArtistModal",i=null;o.on("reset",function(r){if(n===r){var i=o.getModel();i.tracks.forEach(function(e,o){e.playing=!1,e.order=o}),e.model=i,e.model.tracks.forEach(function(e){a[e.id]=t.load(e.preview_url)})}}),o.on("showLoader",function(o){n===o&&(e.showLoader=!0)}),o.on("hideLoader",function(o){n===o&&(e.showLoader=!1)}),o.on("clearModel",function(o){n===o&&(e.model=[])});var l=function(){e.model.tracks.forEach(function(e){e.playing&&(a[e.id].pause(),e.playing=!1)})},s=function(o){var t=Math.round(100*a[o.id].progress);if(o.progress=t,100===t){a[o.id].progress=0,e.pause(o)}};e.getPic=o.getPic,e.getTrackPic=function(o){return e.getPic(o.album)},e.close=function(){l(),o.publish("close",[e.model.modalId])},e.play=function(e){l(),a[e.id].play(),e.playing=!0,s(e),i=r(function(){return s(e)},100)},e.pause=function(e){a[e.id].pause(),e.playing=!1,r.cancel(i)}}]);var base=angular.module("base",["home","albums","tracks","artist","spotifySrvc"]);base.config(["$locationProvider",function(e){e.html5Mode(!0)}]),base.run(["spotify",function(e){e.authorize()}]);var home=angular.module("home",["spotifySrvc","modalHelper","smoothScroll"]);home.controller("homeCtrl",["$scope","$rootScope","spotify","modalHelper","smoothScroll",function(e,o,t,r,a){e.query="",e.currentQuery="",e.results=null,e.showUpperLoader=!1,e.showLowerLoader=!1,o.openAlbumsModal=!1,o.openTracksModal=!1;var n={albums:"openAlbumsModal",tracks:"openTracksModal",artist:"openArtistModal"};r.on("close",function(e){o[e]=!1});var i=function(o,t){return{header:{pic:e.getPic(o),name:o.name},tracks:t,type:o.type,modalId:n.tracks}},l=function(o,t){return{header:{pic:e.getPic(o),name:o.name},albums:t,modalId:n.albums}},s=function(o,t){return{header:{pic:e.getPic(o),name:o.name},tracks:t,modalId:n.artist}};e.search=function(o){0!==o.trim().length&&(e.currentQuery=o,e.showUpperLoader=!0,t.search(e.currentQuery,function(o){e.results=t.normalize(o),e.showUpperLoader=!1}))},e.getPic=function(o){var t="";return o.images?1===o.images.length?t=o.images[0]:o.images.length>0&&(t=o.images[1]):t={url:e.getPic(o.album)},t.url},e.more=function(){e.showLowerLoader=!0,t.searchMore(e.currentQuery,function(o){var t;(t=e.results).push.apply(t,_toConsumableArray(o)),e.showLowerLoader=!1})},e.showBlurred=function(e){return["all_albums","top_tracks"].indexOf(e.type)>-1},e.show=function(e){"all_albums"===e.type?(r.clearModel(n.albums),o.openAlbumsModal=!0,r.publish("showLoader",[n.albums]),t.getAlbumsByArtistID(e.id,function(o){var t=l(e,o);r.setModel(t),r.publish("hideLoader",[n.albums])})):"top_tracks"===e.type?(r.clearModel(n.tracks),o.openTracksModal=!0,r.publish("showLoader",[n.tracks]),t.getTracksByArtistID(e.id,function(o){var t=i(e,o);r.setModel(t),r.publish("hideLoader",[n.tracks])})):"album"===e.type?(r.clearModel(n.tracks),o.openTracksModal=!0,r.publish("showLoader",[n.tracks]),t.getAlbumTracksByID(e.id,function(o){var t=i(e,o);r.setModel(t),r.publish("hideLoader",[n.tracks])})):"artist"===e.type&&(r.clearModel(n.artist),o.openArtistModal=!0,r.publish("showLoader",[n.artist]),t.getTracksByArtistID(e.id,function(o){var t=s(e,o);r.setModel(t),r.publish("hideLoader",[n.artist])}))},e.scrollDown=function(){var e=document.getElementById("scroll-target");a(e,{duration:330,easing:"easeInCubic"})}}]);var CLIENT_ID="0bd2b7d36b5344faa55a8d4cf0ee104b";angular.module("modalHelper",[]).factory("modalHelper",function(){var e={},o={reset:[],close:[],showLoader:[],hideLoader:[],clearModel:[]},t=function(o){a("reset",[(e=o).modalId])},r=function(o){e={},a("clearModel",[o])},a=function(e,t){if(!o[e])throw"modalHelper: cannot publish unknown "+e+" event";o[e].forEach(function(e){return e.apply(void 0,_toConsumableArray(t))})};return{setModel:t,getModel:function(){return e},on:function(e,t){if(!o[e])throw"modalHelper: cannot subscribe to unknown '"+e+"' event";o[e].push(t)},publish:a,getPic:function(e){var o=0;return e.images.length>1&&(o=e.images.length-2),e.images[o].url},clearModel:r}});var spot=angular.module("spotifySrvc",["utils"]);spot.factory("spotify",["ajax","arrays","lstorage","$timeout",function(e,o,t,r){var a="https://api.spotify.com/v1",n=encodeURIComponent(window.location.href),i="",l=0,s="access_token",u=function(e){var t={},r=e.artists.items.shift(),a=e.albums.items.shift(),n=c(e);return o.shuffle(n),r&&((t=angular.copy(r)).type="top_tracks",n.unshift(t)),a&&((t=angular.copy(r)).type="all_albums",n.unshift(t)),a&&n.unshift(a),r&&n.unshift(r),n},c=function(e){var o=e.artists.items;return o=o.concat(e.albums.items)},d=function(e){return{Authorization:"Bearer "+e}},f=function(){var e=t.get(s);if(!e)if(-1===window.location.href.indexOf(s)){var o="https://accounts.spotify.com/authorize?";o+="client_id="+CLIENT_ID,o+="&response_type=token",o+="&redirect_uri="+n,o+="&state=118",window.location.href=o}else{var a=window.location.href,i=a.indexOf("access_token"),l=0;e=a.slice(a.indexOf("=",i)+1,a.indexOf("&",i)),t.set(s,e),i=a.indexOf("expires_in"),l=a.slice(a.indexOf("=",i)+1,a.indexOf("&",i)),r(function(){return t.remove(s)},1e3*l),window.location.href=a.slice(0,a.indexOf("#"))}},m=function(o,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=n.limit||5,u=!angular.isDefined(n.albums)||n.albums,c=!angular.isDefined(n.artists)||n.artists,m=!angular.isDefined(n.tracks)||n.tracks,p=[],h=0,g="",y="",v={};if(!u&&!c&&!m)throw"spotifySrvc: you have to search either for artist, tracks or albums";h=n.pageIdx?n.pageIdx*l:0,g=a+"/search?q="+o+"&market=US&type=",y=t.get(s),v=d(y),y||f(),c&&p.push("artist"),u&&p.push("album"),m&&p.push("track"),g+=p.join(","),g+="&limit="+l,i=o,h>0&&(g+="&offset="+h),e.call(g,{},function(e){return r(e.data)},function(e){return console.log(e)},"get",v)},p=function(o,r){var n=a+"/albums/"+o+"/tracks?market=US",i=t.get(s),l=d(i);e.call(n,{},function(e){var o=e.data.items;o=o.sort(b),r(o)},function(e){return console.log(e.data)},"get",l)},h=function(o,r){var n=a+"/albums?ids="+o.join(",");n+="&market=US",n+="&album_type=album";var i=t.get(s),l=d(i);e.call(n,{},function(e){var o=e.data.albums;r(o)},function(e){return console.log(e.data)},"get",l)},g=function(e){var o=e.release_date;return"year"!=e.release_date_precision&&(o=o.slice(0,o.indexOf("-"))),o},y=function(o,r){var n=a+"/artists/"+o+"/albums?market=US",i=t.get(s),l=d(i);e.call(n,{},function(e){for(var o=[],t=e.data.items.sort(b),a=0;a<t.length&&!(a>20);a++)o.push(t[a].id);h(o,function(e){e.forEach(function(e){e.release_year=g(e)}),r(e)})},function(e){return console.log(e.data)},"get",l)},v=function(o,r){var n=a+"/artists/"+o+"/top-tracks?country=US",i=t.get(s),l=d(i);e.call(n,{},function(e){var o=e.data.tracks;o=o.sort(b),r(o)},function(e){return console.log(e.data)},"get",l)},b=function(e,o){return o.popularity-e.popularity};return{search:m,searchMore:function(e,o){m(e,function(e){o(c(e))},{pageIdx:l=i!=e?0:l+1})},concatenateResults:c,normalize:u,authorize:f,getAlbumTracksByID:p,getAlbumsByArtistID:y,getTracksByArtistID:v,getAlbumsDetailsByID:h}}]),angular.module("tracks",["modalHelper"]).controller("tracksCtrl",["$scope","modalHelper",function(e,o){e.model=[],e.showLoader=!0;var t="openTracksModal";o.on("reset",function(r){if(t===r){var a=o.getModel();a.tracks.forEach(function(e){e.duration=moment.utc(e.duration_ms).format("m:ss")}),e.showLoader=!1,e.model=a}}),o.on("showLoader",function(o){t===o&&(e.showLoader=!0)}),o.on("hideLoader",function(o){t===o&&(e.showLoader=!1)}),o.on("clearModel",function(o){t===o&&(e.model=[])}),e.getPic=o.getPic,e.close=function(){o.publish("close",[e.model.modalId])}}]);var utils=angular.module("utils",[]);utils.factory("ajax",["$http",function(e){return{call:function(o,t,r,a){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"post",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};return i["Content-Type"]="application/x-www-form-urlencoded",e({method:n,headers:i,url:o,data:t}).then(r,a)}}}]),utils.factory("arrays",["$http",function(e){return{shuffle:function e(o){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=void 0,a=void 0,n=void 0;for(r=o.length-1;r>0;r--)a=Math.floor(Math.random()*(r+1)),n=o[r],o[r]=o[a],o[a]=n;return t||e(o,!0),o}}}]),utils.factory("lstorage",function(){return{get:function(e){var o=window.localStorage.getItem(e);try{o=JSON.parse(o)}catch(e){o=o.replace("/","")}return o},set:function(e,o){var t=o;angular.isObject(t)?t=JSON.stringify(o):angular.isNumber(o)&&(t="/"+t),window.localStorage.setItem(e,t)},remove:function(e){return window.localStorage.removeItem(e)},clear:function(){return window.localStorage.clear()}}});